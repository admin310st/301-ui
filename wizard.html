<!doctype html>
<html lang="en" data-theme="dark">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>301.st · Cloudflare Setup Wizard</title>
    <link rel="icon" type="image/svg+xml" href="/favicon.svg" />
    <link rel="alternate icon" type="image/x-icon" href="/favicon.ico" />
    <link rel="stylesheet" href="/css/theme.css" />
    <link rel="stylesheet" href="/css/layout.css" />
    <link rel="stylesheet" href="/css/site.css" />
  </head>
  <body class="layout-dashboard">
{{> sidebar-state-loader}}
    <header class="site-header" role="banner">
{{> header-top}}

      <div class="utility-bar">
        <div class="page-shell utility-bar__inner">
          <div class="utility-left">
            <span class="badges">
              <span class="badge badge--cf">Cloudflare</span>
            </span>
          </div>

{{> header-utility}}
        </div>

{{> global-notice}}
      </div>
    </header>

    <main class="page-shell dashboard-shell">
{{> sidebar activePage="wizard"}}

      <section class="dashboard-content">
        <div class="wizard-container">
          <header class="wizard-header">
            <h1 class="h2" data-i18n="cf.wizard.title">Cloudflare account bootstrap</h1>
            <p class="text-muted" data-i18n="cf.wizard.subtitle">
              Step 1 · Paste your Account ID and Bootstrap API token.
            </p>
          </header>

          <div class="wizard-body">
          <div class="auth-grid">
            <article class="auth-card">
              <header class="auth-section__header" style="display: none;">
                <!-- Moved to wizard-header above -->
              </header>

              <div class="stack">
                <div class="cluster">
                  <div class="avatar-preview">
                    <div class="avatar-ring avatar-ring--cloudflare">
                      <svg class="avatar-icon" aria-hidden="true" focusable="false">
                        <use href="#i-brand-cloudflare"></use>
                      </svg>
                      <span class="sr-only">Cloudflare</span>
                    </div>
                    <p class="avatar-meta" data-i18n="cf.wizard.avatarMeta">
                      Orange action buttons indicate global operations at Cloudflare level.
                    </p>
                  </div>
                </div>

                <!-- Method selection -->
                <nav class="btn-chip-group" role="tablist" aria-label="Setup method">
                  <button
                    type="button"
                    class="btn-chip is-active"
                    role="tab"
                    aria-selected="true"
                    aria-controls="panel-manual"
                    data-cf-method="manual"
                  >
                    <span class="icon" data-icon="mono/shield-account"></span>
                    Scoped Token
                  </button>
                  <button
                    type="button"
                    class="btn-chip"
                    role="tab"
                    aria-selected="false"
                    aria-controls="panel-global"
                    data-cf-method="global"
                  >
                    <span class="icon" data-icon="mono/zap"></span>
                    Quick Setup
                  </button>
                </nav>

                <!-- Manual Token Method (Recommended) -->
                <div id="panel-manual" role="tabpanel" data-cf-panel="manual">
                  <form class="auth-form stack" data-form="cf-bootstrap-manual">
                    <div class="field">
                      <label class="field-label" data-i18n="cf.wizard.accountIdLabel">Cloudflare Account ID</label>
                      <input
                        class="input"
                        type="text"
                        name="cf_account_id"
                        autocomplete="off"
                        data-i18n-placeholder="cf.wizard.accountIdPlaceholder"
                        placeholder="e.g. 1234567890abcdef1234567890abcdef"
                        required
                        aria-describedby="cf-status-manual"
                      />
                    </div>

                    <div class="field">
                      <label class="field-label" data-i18n="cf.wizard.tokenLabel">Bootstrap API token</label>
                      <textarea
                        class="textarea"
                        name="cf_bootstrap_token"
                        rows="4"
                        data-i18n-placeholder="cf.wizard.tokenPlaceholder"
                        placeholder="Paste token with 'Account API Tokens: Edit' scope…"
                        required
                        aria-describedby="cf-token-hint cf-curl-hint cf-status-manual"
                      ></textarea>
                      <p class="field-hint text-muted" id="cf-token-hint" data-i18n="cf.wizard.tokenHint">
                        Created as <code>301st Bootstrap</code> with <strong>Account Settings: Edit</strong> and <strong>API Tokens: Edit</strong> permissions.
                      </p>
                      <div class="panel panel--info" id="cf-curl-hint" style="margin-top: var(--space-2);">
                        <p class="text-sm">
                          <span class="icon" data-icon="mono/zap"></span>
                          <strong>Quick tip:</strong> Paste the entire <code>curl</code> test command from Cloudflare into the <strong>Bootstrap API token</strong> field above, and we'll extract both Account ID and token automatically.
                        </p>
                      </div>
                    </div>

                    <div class="auth-actions">
                      <button
                        type="submit"
                        class="btn btn--cf"
                        data-i18n="cf.wizard.submit"
                        data-i18n-aria="cf.wizard.submitAria"
                        aria-label="Save and verify Cloudflare token"
                      >
                        Save &amp; verify token
                      </button>
                    </div>

                    <div
                      class="auth-status"
                      data-type="pending"
                      data-form-status="cf-bootstrap-manual"
                      id="cf-status-manual"
                      role="status"
                      aria-live="polite"
                    >
                      Enter your credentials above to begin validation.
                    </div>
                  </form>
                </div>

                <!-- Global API Key Method (Quick but risky) -->
                <div id="panel-global" role="tabpanel" data-cf-panel="global" hidden>
                  <form class="auth-form stack" data-form="cf-bootstrap-global">
                    <div class="field">
                      <label class="field-label">Cloudflare Account Email</label>
                      <input
                        class="input"
                        type="email"
                        name="cf_account_email"
                        autocomplete="email"
                        placeholder="your-email@example.com"
                        required
                        aria-describedby="cf-status-global"
                      />
                      <p class="field-hint text-muted">
                        The email address associated with your Cloudflare account.
                      </p>
                    </div>

                    <div class="field">
                      <label class="field-label">Global API Key</label>
                      <textarea
                        class="textarea"
                        name="cf_global_key"
                        rows="3"
                        placeholder="Paste your Global API Key…"
                        required
                        aria-describedby="cf-global-hint cf-status-global"
                      ></textarea>
                      <p class="field-hint text-muted" id="cf-global-hint">
                        Found in Cloudflare dashboard: <strong>My Profile → API Tokens → Global API Key → View</strong>
                      </p>
                    </div>

                    <div class="auth-actions">
                      <button
                        type="submit"
                        class="btn btn--danger"
                        aria-label="Create scoped token from Global API Key"
                      >
                        <span class="icon" data-icon="mono/zap"></span>
                        Create scoped token
                      </button>
                      <button
                        type="button"
                        class="btn btn--ghost"
                        data-switch-method="manual"
                      >
                        Switch to Manual Token
                      </button>
                    </div>

                    <div
                      class="auth-status"
                      data-type="pending"
                      data-form-status="cf-bootstrap-global"
                      id="cf-status-global"
                      role="status"
                      aria-live="polite"
                    >
                      Enter your credentials above. We'll create a scoped token and immediately discard the Global API Key.
                    </div>
                  </form>
                </div>
              </div>
            </article>

            <aside class="card card--panel card--compact" data-auth="guest">
              <header class="card__header">
                <h3 class="card__title" data-cf-help="manual">How to get your credentials</h3>
                <h3 class="card__title" data-cf-help="global" hidden>Quick Setup Guide</h3>
              </header>
              <div class="card__body">
                <!-- Manual method help -->
                <div class="step-list" data-cf-help="manual">
                  <div class="step-item">
                    <span class="badge badge--sm">1</span>
                    <div class="stack stack--xs">
                      <strong>Account ID</strong>
                      <p class="text-sm text-muted">
                        Open Cloudflare dashboard → use quick search (press <kbd>/</kbd>) → type <code>copy</code> →
                        select <strong>"Copy account ID"</strong> command
                      </p>
                    </div>
                  </div>

                  <div class="step-item">
                    <span class="badge badge--sm">2</span>
                    <div class="stack stack--xs">
                      <strong>Bootstrap API Token</strong>
                      <p class="text-sm text-muted">
                        Go to <strong>Manage Account → Account API Tokens → Create Custom Token</strong>.
                        Set token name to <code>301st Bootstrap</code>.
                        Add two permissions:
                      </p>
                      <ul class="text-sm text-muted" style="margin: var(--space-1) 0 0 var(--space-4); padding: 0;">
                        <li><strong>Account Settings</strong>: Edit (Resource: Account)</li>
                        <li><strong>API Tokens</strong>: Edit (Resource: Account)</li>
                      </ul>
                    </div>
                  </div>

                  <div class="step-item">
                    <span class="badge badge--sm">3</span>
                    <div class="stack stack--xs">
                      <strong>Verify</strong>
                      <p class="text-sm text-muted">
                        Paste credentials above and click "Save &amp; verify token" to validate and enable domain management
                      </p>
                    </div>
                  </div>
                </div>

                <div class="panel panel--success" style="margin-top: var(--space-3);" data-cf-help="manual">
                  <div class="stack" style="gap: var(--space-2);">
                    <p class="text-sm">
                      <span class="btn-icon btn-icon--compact btn--success">
                        <span class="icon" data-icon="mono/check-circle"></span>
                      </span>
                      Scoped tokens limit what 301.st can access.
                    </p>
                    <p class="text-sm text-muted">We'll never see your Cloudflare password or Global API Key.</p>
                  </div>
                </div>

                <!-- Global method help -->
                <div data-cf-help="global" hidden>
                  <div class="panel panel--danger" style="margin-bottom: var(--space-3);">
                    <p class="text-sm">
                      <span class="btn-icon btn-icon--compact btn--danger">
                        <span class="icon" data-icon="mono/alert-triangle"></span>
                      </span>
                      Global API Key gives full access to your account. We'll create a scoped token and immediately discard the key,
                      but if compromised during this process, your account could be exposed.
                    </p>
                  </div>

                  <div class="step-list">
                    <div class="step-item">
                      <span class="badge badge--sm">1</span>
                      <div class="stack stack--xs">
                        <strong>Account Email</strong>
                        <p class="text-sm text-muted">
                          The email you use to log in to Cloudflare
                        </p>
                      </div>
                    </div>

                    <div class="step-item">
                      <span class="badge badge--sm">2</span>
                      <div class="stack stack--xs">
                        <strong>Global API Key</strong>
                        <p class="text-sm text-muted">
                          Go to <strong>My Profile → API Tokens → Global API Key → View</strong> → enter password to reveal
                        </p>
                      </div>
                    </div>
                  </div>
                </div>
              </div>
              <footer class="card__footer auth-actions">
                <a class="btn btn--ghost" href="https://dash.cloudflare.com" target="_blank" rel="noopener">
                  <span class="icon" data-icon="mono/open-in-new"></span>
                  Open Cloudflare
                </a>
              </footer>
            </aside>
          </div> <!-- /.auth-grid -->
          </div> <!-- /.wizard-body -->
        </div> <!-- /.wizard-container -->
      </section> <!-- /.dashboard-content -->
    </main> <!-- /.dashboard-shell -->

{{> footer}}

    <script type="module" src="/src/main.ts"></script>
    <script>
      // Simple tab switching logic (until we wire up proper form handlers)
      document.addEventListener('DOMContentLoaded', () => {
        const tabs = document.querySelectorAll('[data-cf-method]');
        const panels = document.querySelectorAll('[data-cf-panel]');
        const helpSections = document.querySelectorAll('[data-cf-help]');
        const switchBtn = document.querySelector('[data-switch-method]');

        function switchMethod(method) {
          tabs.forEach(tab => {
            const isActive = tab.dataset.cfMethod === method;
            tab.classList.toggle('is-active', isActive);
            tab.setAttribute('aria-selected', isActive);
          });

          panels.forEach(panel => {
            const isVisible = panel.dataset.cfPanel === method;
            panel.hidden = !isVisible;
          });

          helpSections.forEach(section => {
            const isVisible = section.dataset.cfHelp === method;
            section.hidden = !isVisible;
          });
        }

        tabs.forEach(tab => {
          tab.addEventListener('click', () => {
            switchMethod(tab.dataset.cfMethod);
          });
        });

        if (switchBtn) {
          switchBtn.addEventListener('click', () => {
            switchMethod('manual');
          });
        }
      });
    </script>
  </body>
</html>
