<!doctype html>
<html lang="ru" data-theme="dark">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>301.st · Auth</title>
    <link rel="icon" type="image/svg+xml" href="/favicon.svg" />
    <link rel="alternate icon" type="image/x-icon" href="/favicon.ico" />
    <link rel="stylesheet" href="/css/theme.css" />
    <link rel="stylesheet" href="/css/site.css" />
  </head>
  <body>
    <header class="site-header">
      <div class="container header-bar">
        <a class="brand" href="/">301.st</a>
        <nav class="nav-links" data-onlogout>
          <a href="#login" data-route-link="login">Вход</a>
          <a href="#register" data-route-link="register">Регистрация</a>
          <a href="#forgot" data-route-link="forgot">Забыли пароль?</a>
        </nav>
        <div class="nav-links" data-onlogin hidden>
          <span data-user-email></span>
          <button class="btn btn-secondary" data-action="logout">Выйти</button>
        </div>
      </div>
    </header>

    <main class="page">
      <section data-route="login" id="login">
        <div class="container auth-grid">
          <div class="auth-card">
            <p class="eyebrow">Боевой вход</p>
            <h1>Войти в 301.st</h1>
            <p class="auth-subtitle">Используйте email и пароль, чтобы попасть в аккаунт.</p>

            <form id="auth-login-form" data-form="login">
              <div class="field">
                <label for="signin-email">Email</label>
                <input
                  class="input"
                  id="signin-email"
                  name="email"
                  type="email"
                  autocomplete="email"
                  required
                  data-avatar-source
                />
              </div>

              <div class="field">
                <label for="signin-password">Пароль</label>
                <input
                  class="input"
                  id="signin-password"
                  name="password"
                  type="password"
                  autocomplete="current-password"
                  required
                />
              </div>

              <div data-status class="auth-status" hidden></div>

              <input type="hidden" name="turnstile_token" value="" />
              <div class="turnstile-widget" aria-live="polite"></div>

              <div class="auth-actions">
                <button type="submit" class="btn btn-primary" data-auth-submit="login">Войти</button>
                <a href="#register" class="btn btn-secondary" data-route-link="register">Создать аккаунт</a>
              </div>
            </form>

            <div class="auth-links">
              <a href="#register" data-route-link="register">Регистрация</a>
              <a href="#forgot" data-route-link="forgot">Забыли пароль?</a>
            </div>
          </div>

          <div class="side-card">
            <h3>Аватар по email</h3>
            <p class="muted">Для демонстрации логина подтягиваем Gravatar сразу при вводе почты.</p>
            <div class="avatar-preview">
              <div class="avatar-ring">
                <img data-avatar-img src="/img/anonymous-avatar.svg" alt="Avatar" />
              </div>
              <div>
                <strong data-avatar-label>Укажите email</strong>
                <p class="avatar-meta">Аватар обновится мгновенно.</p>
              </div>
            </div>
          </div>
        </div>
      </section>

      <section data-route="register" id="register" hidden>
        <div class="container auth-grid">
          <div class="auth-card">
            <p class="eyebrow">Создать аккаунт</p>
            <h1>Регистрация</h1>
            <p class="auth-subtitle">Введите email и пароль, чтобы подключить 301.st.</p>

            <form data-form="register">
              <div class="field">
                <label for="register-email">Email</label>
                <input class="input" id="register-email" name="email" type="email" required />
              </div>
              <div class="field">
                <label for="register-password">Пароль</label>
                <input
                  class="input"
                  id="register-password"
                  name="password"
                  type="password"
                  autocomplete="new-password"
                  required
                />
              </div>

              <div data-status class="auth-status" hidden></div>

              <input type="hidden" name="turnstile_token" value="" />
              <div class="turnstile-widget" aria-live="polite"></div>

              <div class="auth-actions">
                <button type="submit" class="btn btn-primary" data-auth-submit="register">Создать</button>
                <a href="#login" class="btn btn-secondary" data-route-link="login">Я уже зарегистрирован</a>
              </div>
            </form>
          </div>

          <div class="side-card">
            <h3>Боевой поток</h3>
            <p class="muted">
              Регистрация и вход работают через продовый API 301.st.
              Email подтверждается через OmniFlow, вход — по access_token + refresh cookie.
            </p>
            <ul class="panel-list">
              <li><span class="label">API</span><span class="value">https://api.301.st/auth</span></li>
              <li><span class="label">Token</span><span class="value">JWT · 15 минут</span></li>
              <li><span class="label">Session</span><span class="value">refresh cookie · 7 дней</span></li>
            </ul>
          </div>
        </div>
      </section>

      <section data-route="forgot" id="forgot" hidden>
        <div class="container auth-grid">
          <div class="auth-card">
            <p class="eyebrow">Восстановление</p>
            <h2>Запросить сброс</h2>
            <form data-form="reset-request">
              <div class="field">
                <label for="reset-email">Email</label>
                <input class="input" id="reset-email" name="value" type="email" required />
              </div>

              <div data-status class="auth-status" hidden></div>

              <input type="hidden" name="type" value="email" />

              <input type="hidden" name="turnstile_token" value="" />
              <div class="turnstile-widget" aria-live="polite"></div>

              <div class="auth-actions">
                <button type="submit" class="btn btn-primary">Отправить ссылку</button>
                <a href="#login" class="btn btn-secondary" data-route-link="login">Вернуться ко входу</a>
              </div>
            </form>
          </div>
        </div>
      </section>

      <section data-route="verify" id="verify" hidden>
        <div class="container auth-grid">
          <div class="auth-card">
            <p class="eyebrow">Подтверждение</p>
            <h2>Подтверждаем…</h2>
            <p class="muted">Мы проверяем ссылку из письма. Это займёт пару секунд.</p>
            <div data-verify-status class="auth-status" hidden></div>
          </div>
        </div>
      </section>

      <section data-route="reset" id="reset" hidden>
        <div class="container auth-grid">
          <div class="auth-card">
            <p class="eyebrow">Новый пароль</p>
            <h2>Установить пароль</h2>
            <form data-form="reset-confirm">
              <div class="field">
                <label for="reset-password">Новый пароль</label>
                <input class="input" id="reset-password" name="password" type="password" required />
              </div>
              <div class="field">
                <label for="reset-password-confirm">Повторите пароль</label>
                <input class="input" id="reset-password-confirm" name="password_confirm" type="password" required />
              </div>
              <div data-status class="auth-status" hidden></div>
              <div class="auth-actions">
                <button type="submit" class="btn btn-primary">Обновить пароль</button>
                <a href="#login" class="btn btn-secondary" data-route-link="login">Войти</a>
              </div>
            </form>
          </div>
        </div>
      </section>

      <section data-route="account" id="account" hidden>
        <div class="container" data-onlogin hidden>
          <div class="auth-card">
            <h2>Состояние сессии</h2>
            <p>
              Вы вошли как <strong data-auth-email data-user-email></strong>.
              Текущая роль: <span data-user-role>client:owner</span>.
            </p>
            <p class="muted">
              Access token живёт 15 минут, продление сессии — через refresh cookie.
            </p>
            <button class="btn btn-secondary" data-action="logout">Выйти</button>
          </div>

          <section data-integrations-wizard="cloudflare" class="wizard">
            <header class="wizard-header">
              <div>
                <p class="eyebrow">Интеграции</p>
                <h2>Cloudflare</h2>
                <p class="muted">Подключите аккаунт Cloudflare, чтобы управлять зонами.</p>
              </div>
            </header>

            <div class="wizard-grid">
              <ol class="wizard-steps">
                <li class="wizard-step is-active" data-step="1" aria-current="step">Добавьте Bootstrap Token</li>
                <li class="wizard-step" data-step="2">Настройте зоны</li>
                <li class="wizard-step" data-step="3">Подтвердите выпуск сертификатов</li>
              </ol>

              <div class="wizard-panels">
                <section class="wizard-step-panel is-active" data-step-panel="1">
                  <h3>Шаг 1. Добавьте Cloudflare Bootstrap Token</h3>
                  <p class="muted">Укажите Account ID и bootstrap токен, полученный в Cloudflare.</p>

                  <form data-form="cf-bootstrap">
                    <div class="field">
                      <label>Cloudflare Account ID</label>
                      <input type="text" name="cf_account_id" required />
                    </div>
                    <div class="field">
                      <label>Bootstrap Token</label>
                      <textarea name="cf_bootstrap_token" rows="3" required></textarea>
                    </div>

                    <div class="turnstile-widget" aria-live="polite"></div>
                    <input type="hidden" name="turnstile_token" />

                    <button type="submit" class="btn primary">Сохранить и проверить</button>
                    <p class="form-status" data-status></p>
                  </form>
                </section>

                <section class="wizard-step-panel" data-step-panel="2" hidden>
                  <h3>Шаг 2. Настройка зон</h3>
                  <p class="muted">После сохранения токена вы сможете выбрать зоны и подключить их к 301.st.</p>
                </section>

                <section class="wizard-step-panel" data-step-panel="3" hidden>
                  <h3>Шаг 3. Подтверждение</h3>
                  <p class="muted">Завершите настройку SSL и убедитесь, что редиректы работают.</p>
                </section>
              </div>
            </div>
          </section>
        </div>
        <div class="container" data-onlogout>
          <div class="auth-card">
            <h2>Вы не авторизованы</h2>
            <p>Перейдите на страницу входа.</p>
            <a class="btn btn-primary" href="#login" data-route-link="login">Войти</a>
          </div>
        </div>
      </section>
    </main>

    <div class="container" data-global-message hidden></div>

    <footer class="site-footer">
      <div class="container footer-grid">
        <div>
          <div class="brand">301.st</div>
          <p class="muted">Редиректы и аналитика.</p>
        </div>
        <div class="footer-links">
          <a href="#login" data-route-link="login">Вход</a>
          <a href="#register" data-route-link="register">Регистрация</a>
          <a href="#forgot" data-route-link="forgot">Забыли пароль?</a>
        </div>
      </div>
    </footer>

    <script type="module" src="/src/main.ts"></script>
  </body>
</html>
